<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare AI Chat</title>
    <!-- Muat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Muat Lucide Icons untuk ikon estetis -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Konfigurasi Tailwind dan variabel kustom */
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --assistant-bg: #1F1F1F; /* Latar belakang gelap untuk pesan */
            --user-bg: #3C4043; /* Warna gelap sedikit lebih terang untuk pesan pengguna */
            --background: #000000; /* Latar belakang hitam pekat */
            --text-light: #E8EAED;
            --text-muted: #9AA0A6;
            --border: #3C4043;
        }
        
        /* Custom scrollbar untuk tampilan yang ramping */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 10px;
        }

        /* Atur 'Inter' sebagai font utama */
        html {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-light);
        }

        /* Pastikan tinggi textarea bisa bertambah */
        #user-input {
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex flex-col h-screen bg-black">

    <!-- Header - Minimalis dan terpusat, mempertahankan logo -->
    <header class="flex justify-between items-center px-4 md:px-6 py-3 border-b border-gray-800 bg-[#0A0A0A] fixed top-0 left-0 w-full z-10">
        <!-- Logo Kiri (Contoh: Cloudflare) -->
        <img src="cf.png" alt="Cloudflare Logo" class="h-10 w-10 rounded-full object-cover shadow-lg" />
        
        <!-- Judul Terpusat -->
        <div class="text-xl font-bold text-white tracking-wider">
            Cloudflare AI Chat
        </div>
        
        <!-- Logo Kanan (Contoh: Westcon) -->
        <img src="ws.png" alt="Westcon Logo" class="h-10 w-10 rounded-full object-cover shadow-lg" />
    </header>

    <!-- Area Chat Utama -->
    <main class="flex-1 overflow-hidden pt-16 pb-24 flex justify-center">
        <!-- Container Pesan Chat Terpusat -->
        <div id="chat-messages" class="chat-messages w-full max-w-3xl mx-auto p-4 md:p-6 overflow-y-auto flex flex-col gap-6">
            
            <!-- Indikator Mengetik (Tersembunyi secara default) -->
            <div id="typing-indicator" class="flex items-center self-start invisible">
                <div class="p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mr-3">
                    <i data-lucide="gem" class="w-5 h-5 text-white"></i>
                </div>
                <div class="p-3 bg-gray-800 rounded-xl rounded-tl-none text-gray-400 italic">
                    AI sedang berpikir<span id="dots">...</span>
                </div>
            </div>

        </div>
    </main>

    <!-- Kotak Input Mengambang di Bawah -->
    <div class="fixed bottom-0 left-0 w-full flex justify-center p-4 bg-gradient-to-t from-black via-black/90 to-transparent z-20">
        <div class="input-box w-full max-w-3xl flex items-end p-2 md:p-3 bg-gray-900 border border-gray-700 rounded-3xl shadow-2xl shadow-blue-900/50">
            <textarea
                id="user-input"
                placeholder="Tanyakan apa saja di sini..."
                rows="1"
                class="flex-1 border-none bg-transparent text-white placeholder-gray-500 text-base resize-none outline-none pr-3 py-1.5"
                autofocus
            ></textarea>
            <button id="send-button" title="Kirim Pesan" disabled
                    class="ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-blue-600 text-white transition-all duration-200 disabled:bg-gray-700 disabled:text-gray-400 disabled:cursor-not-allowed hover:bg-blue-700">
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-xs text-gray-600 p-2 fixed bottom-0 left-0 w-full z-0">
        Â© 2025 Cloudflare AI Chat | Desain terinspirasi oleh Gemini UI
    </footer>

    <script>
        /**
         * LLM Chat App Frontend
         *
         * Mengelola interaksi UI chat dan simulasi komunikasi dengan backend API.
         */

        // Elemen DOM
        const chatMessages = document.getElementById("chat-messages");
        const userInput = document.getElementById("user-input");
        const sendButton = document.getElementById("send-button");
        const typingIndicator = document.getElementById("typing-indicator");

        // Status Chat
        let chatHistory = [
            {
                role: "assistant",
                content:
                    "Halo! Saya adalah aplikasi chat LLM yang didukung oleh Cloudflare Workers AI. Ada yang bisa saya bantu hari ini?",
            },
        ];
        let isProcessing = false;

        // --- Fungsi Pembantu untuk UI ---

        /** Menyesuaikan tinggi textarea berdasarkan konten dan memperbarui status tombol. */
        function adjustInputHeight(textarea) {
            textarea.style.height = "auto"; // Atur ulang tinggi
            textarea.style.height = textarea.scrollHeight + "px"; // Atur ke tinggi scroll

            // Mengaktifkan/menonaktifkan tombol berdasarkan konten dan status pemrosesan
            sendButton.disabled = textarea.value.trim() === "" || isProcessing;
        }

        /** Menggulir area chat ke bawah */
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        /**
         * Fungsi pembantu untuk menambahkan pesan ke chat, menggunakan struktur UI Tailwind/Lucide yang baru.
         */
        function addMessageToChat(role, content) {
            const isAssistant = role === "assistant";
            const messageElement = document.createElement("div");
            messageElement.className = "flex items-start"; // Kelas dasar

            // Pengaturan Ikon berdasarkan peran
            const iconHtml = isAssistant
                ? '<div class="p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mr-3"><i data-lucide="gem" class="w-5 h-5 text-white"></i></div>'
                : '<div class="p-2 bg-gray-600 rounded-full ml-3"><i data-lucide="user" class="w-5 h-5 text-white"></i></div>';

            // Struktur konten pesan
            const messageContentHtml = `
                <div class="flex-1 min-w-0 ${
                    isAssistant ? "" : "text-right flex flex-col items-end"
                } max-w-[80%]">
                    <p class="text-sm font-semibold text-gray-300 mb-1">${
                        isAssistant ? "AI Assistant" : "Anda"
                    }</p>
                    <div class="p-3 shadow-lg text-white whitespace-pre-wrap text-left ${
                        isAssistant
                            ? "bg-gray-800 rounded-xl rounded-tl-none"
                            : "bg-blue-600 rounded-xl rounded-tr-none"
                    } prose prose-invert">
                        ${content}
                    </div>
                </div>
            `;

            // Perakitan akhir berdasarkan perataan peran
            if (isAssistant) {
                messageElement.innerHTML = iconHtml + messageContentHtml;
            } else {
                messageElement.className = "flex justify-end";
                messageElement.innerHTML = `
                    <div class="flex items-start flex-row-reverse max-w-[80%]">
                        ${iconHtml}
                        ${messageContentHtml}
                    </div>
                `;
            }

            chatMessages.appendChild(messageElement);
            // Render ulang ikon baru (jika lucide dimuat)
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
            scrollToBottom();
        }

        // --- Event Listener dan Logika Utama ---

        // Auto-resize textarea saat pengguna mengetik dan mengelola status tombol
        userInput.addEventListener("input", function () {
            adjustInputHeight(this);
        });

        // Kirim pesan saat menekan Enter (tanpa Shift)
        userInput.addEventListener("keydown", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                // Hanya panggil sendMessage jika tombol tidak dinonaktifkan
                if (!sendButton.disabled) {
                    sendMessage();
                }
            }
        });

        // Handler klik tombol kirim
        sendButton.addEventListener("click", sendMessage);

        /**
         * Mengirim pesan ke API chat dan memproses respons streaming (simulasi)
         */
        async function sendMessage() {
            const message = userInput.value.trim();

            // Jangan kirim pesan kosong atau jika sedang memproses
            if (message === "" || isProcessing) return;

            // 1. Pengaturan UI untuk pengiriman
            isProcessing = true;
            userInput.disabled = true;
            sendButton.disabled = true; // Nonaktifkan tombol segera

            // 2. Tambahkan pesan pengguna ke chat dan kosongkan input
            addMessageToChat("user", message);
            userInput.value = "";
            adjustInputHeight(userInput); // Atur ulang tinggi dan nonaktifkan tombol secara visual

            // 3. Tampilkan indikator mengetik
            typingIndicator.classList.remove("invisible");
            scrollToBottom();

            // 4. Tambahkan pesan ke riwayat
            chatHistory.push({ role: "user", content: message });

            // 5. Buat elemen respons asisten baru (untuk streaming)
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = `<div class="flex items-start">
                <div class="p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mr-3"><i data-lucide="gem" class="w-5 h-5 text-white"></i></div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-gray-300 mb-1">AI Assistant</p>
                    <div class="p-3 bg-gray-800 rounded-xl rounded-tl-none shadow-md text-gray-200 prose prose-invert">
                        <span id="streaming-text"></span>
                    </div>
                </div>
            </div>`;
            
            // Tambahkan struktur sementara dan ambil span streaming
            chatMessages.appendChild(tempDiv.firstChild);
            const streamingTextEl = chatMessages.lastElementChild.querySelector("#streaming-text");
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
            scrollToBottom();

            let responseText = "";

            try {
                // SIMULASI: Ganti ini dengan PANGGILAN API SEBENARNYA Anda
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
                
                // SIMULASI: Respons dari API
                const simulatedResponse = `Tentu! Saya akan menjelaskan respons dalam beberapa langkah singkat.
1.  **Penggabungan:** Semua kode HTML, CSS, dan JavaScript kini berada dalam satu file untuk pratinjau yang mudah.
2.  **UI:** Desain tetap menggunakan Tailwind CSS dan ikon Lucide untuk tampilan dark mode ala Gemini.
3.  **Logika Input:** Fungsi Enter telah diperbaiki agar pesan dapat dikirim dengan benar saat menekan Enter (kecuali Shift+Enter).
4.  **Streaming:** Meskipun ini adalah simulasi, strukturnya siap untuk menerima respons secara *streaming*.

Terima kasih telah menggunakan Cloudflare AI Chat.`;

                // SIMULASI: Animasi mengetik
                for (let i = 0; i < simulatedResponse.length; i++) {
                    responseText += simulatedResponse[i];
                    streamingTextEl.textContent = responseText;
                    scrollToBottom();
                    await new Promise(resolve => setTimeout(resolve, 10)); // Jeda singkat untuk efek mengetik
                }


                // Finalisasi konten pesan
                
                // Hapus elemen streaming (seluruh div pesan)
                if (chatMessages.lastElementChild && chatMessages.lastElementChild.querySelector('#streaming-text')) {
                    chatMessages.removeChild(chatMessages.lastElementChild);
                }
                
                // Gunakan addMessageToChat untuk memformat konten pesan akhir dengan benar
                addMessageToChat("assistant", responseText);

                // 6. Tambahkan respons yang selesai ke riwayat chat
                chatHistory.push({ role: "assistant", content: responseText });

            } catch (error) {
                console.error("Kesalahan:", error);
                
                // Bersihkan elemen streaming parsial jika gagal di tengah jalan
                if (chatMessages.lastElementChild && chatMessages.lastElementChild.querySelector('#streaming-text')) {
                    chatMessages.removeChild(chatMessages.lastElementChild);
                }
                
                addMessageToChat(
                    "assistant",
                    "Maaf, terjadi kesalahan saat memproses permintaan Anda. (Lihat konsol untuk detailnya)",
                );
            } finally {
                // 7. Bersihkan
                typingIndicator.classList.add("invisible");
                isProcessing = false;
                userInput.disabled = false;
                
                // Aktifkan kembali tombol berdasarkan nilai input saat ini
                adjustInputHeight(userInput); 
                userInput.focus();
            }
        }


        // --- Pengaturan Awal ---

        window.onload = () => {
            // 1. Inisialisasi ikon Lucide
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }

            // 2. Tambahkan pesan sambutan awal (dari chatHistory)
            if (chatHistory.length > 0 && chatHistory[0].role === 'assistant') {
                // Hapus pesan placeholder dan tambahkan pesan sambutan yang didefinisikan dalam chatHistory
                chatMessages.innerHTML = ''; 
                addMessageToChat(chatHistory[0].role, chatHistory[0].content);
            }
            
            // 3. Pastikan tinggi input dan status tombol sudah benar saat dimuat
            adjustInputHeight(userInput);
            
            // 4. Animasi indikator mengetik (titik-titik)
            setInterval(() => {
                const dots = document.getElementById('dots');
                if (dots) {
                    dots.textContent = dots.textContent.length < 3 ? dots.textContent + '.' : '';
                }
            }, 500);
        };
    </script>
</body>
</html>
